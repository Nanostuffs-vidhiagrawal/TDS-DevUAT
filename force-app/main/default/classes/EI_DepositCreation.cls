@RestResource(UrlMapping='/v1.2/CreateDeposit/')
global class EI_DepositCreation {
    @HttpPost
    global static void doPost()
    { fromJSON fj = new  fromJSON();
     list<string> missingAuth = new List<String>();
     try{
         fj = (fromJSON) System.JSON.deserialize(RestContext.request.requestBody.toString(), fromJSON.class);
     }catch(Exception e){
         RestContext.response.responseBody = Blob.valueOf( '{"error":"User tenancy reference is mandatory","success":"false"}');
         RestContext.response.statusCOde =300;
         return; 
     }
     system.debug('qwer5t'+fj);
     RestContext.response.addHeader('Content-Type', 'application/json');
     
     if(String.isBlank(fj.member_id) ){
         missingAuth.add('member_id');
     } if(String.isBlank(fj.branch_id) ){
         missingAuth.add('branch_id');
     } if(String.isBlank(fj.api_key) ){
         missingAuth.add('api_key');
     } if(String.isBlank(fj.scheme_type) ){
         missingAuth.add('scheme_type');
     } if(String.isBlank(fj.region) ){
         missingAuth.add('region');
     }
     if(missingAuth.size()>0){
         RestContext.response.responseBody = Blob.valueOf( '{"error":"'+String.join(missingAuth,', ')+' is mandatory","success":"false"}');
         RestContext.response.statusCode =300;
         return;
     }
     for(cls_tenancy ten : fj.tenancy){
         if(String.isBlank(ten.user_tenancy_reference) ){
             missingAuth.add('user_tenancy_reference');
         } if(String.isBlank(ten.property_paon) ){
             missingAuth.add('property_paon');
         } if(String.isBlank(ten.property_street) ){
             missingAuth.add('property_street');
         } if(String.isBlank(ten.property_town) ){
             missingAuth.add('property_town');
         } if(String.isBlank(ten.property_administrative_area) ){
             missingAuth.add('property_administrative_area');
         } if(String.isBlank(ten.property_postcode)) {
             missingAuth.add('property_postcode');
         } if(ten.tenancy_start_date == null) {
             missingAuth.add('tenancy_start_date');
         } if(ten.tenancy_expected_end_date == null){
             missingAuth.add('tenancy_expected_end_date');
         }
          if(missingAuth.size()>0){
         RestContext.response.responseBody = Blob.valueOf( '{"error":"'+String.join(missingAuth,', ')+' is mandatory","success":"false"}');
         RestContext.response.statusCOde =300;
         return;
     }                
         
     }
    }
    //
    //Generated by AdminBooster
    //
    
    public class fromJSON{
        public String member_id;	//18881
        public String branch_id;	//20001
        public String api_key;	//ABCDE-12345-FGHIJ-67890-KLMNO
        public String region;	//EW
        public String scheme_type;	//Custodial
        public cls_tenancy[] tenancy;
    }
    public class cls_tenancy {
        public String user_tenancy_reference;	//1//Mandatory
        public String property_id;	//1
        public String property_paon;
        public String property_locality;
        public string property_town ;
        public string property_administrative_area;
        public string property_postcode ;
        public String property_saon;	//
        public String property_street;	//Test Street
        public Date tenancy_start_date;
        public Date tenancy_expected_end_date;
        public Integer number_of_living_rooms;
        public Integer number_of_bedrooms ; 
        public String furnished_status;
        public Integer rent_amount;
        public String product_type ;
        public Integer deposit_amount;
        public Integer deposit_amount_to_protect;
        public Date deposit_received_date;
        public String number_of_tenants;	//1
        public String number_of_landlords;	//1
        public cls_people[] people;
    }
    public class cls_people {
        public String person_classification;	//Lead Tenant
        public String person_id;	//
        public String person_reference;	//
        public String person_title;	//Mr
        public String person_firstname;	//Lead
        public String person_surame;	//Tenant
        public String is_business;	//N
        public String business_name;	
        public String  person_paon;
        public String person_saon;
        public String person_street;
        public String person_locality;
        public String person_town;
        public String person_administrative_area;
        public String person_postcode;
        public String person_country;
        public String person_phone;
        public String person_fax;
        public String person_email;
        public String person_mobile;
        public String correspondence_paon;
        public String correspondence_saon;
        public String correspondence_street;
        public String correspondence_town;
        public String correspondence_locality;
        public String correspondence_administrativearea;
        public String correspondence_postcode;
        public String correspondence_country;
    }
    
    
    /*static testMethod void testParse() {
String json=		'{'+
'   "member_id":"18881",'+
'   "branch_id":"20001",'+
'   "api_key":"ABCDE-12345-FGHIJ-67890-KLMNO",'+
'   "region":"EW",'+
'   "scheme_type":"Custodial",'+
'   "tenancy":['+
'      {'+
'         "user_tenancy_reference":"1",'+
'         "property_id":"1",'+
'         "property_paon":"1",'+
'         "property_saon":"",'+
'         "property_street":"Test Street",'+
'         "number_of_tenants":"1",'+
'         "number_of_landlords":"1",'+
'         "people":['+
'            {'+
'               "person_classification":"Lead Tenant",'+
'               "person_id":"",'+
'               "person_reference":"",'+
'               "person_title":"Mr",'+
'               "person_firstname":"Lead",'+
'               "person_surame":"Tenant",'+
'               "is_business":"N",'+
'               "person_correspondence_country":"United Kingdom"'+
'            },'+
'            {'+
'               "person_classification":"Primary Landlord",'+
'               "person_id":"",'+
'               "person_reference":"",'+
'               "person_title":"Miss",'+
'               "person_firstname":"Primary",'+
'               "person_surame":"Landlord",'+
'               "is_business":"N",'+
'               "person_correspondence_country":"United Kingdom"'+
'            }'+
'         ]'+
'      }'+
'   ]'+
'}';
fromJSON obj = parse(json);
System.assert(obj != null);
}*/
    
}